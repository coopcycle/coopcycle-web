<table class="table">
  <thead>
    <th></th>
    <th>{{ 'basics.name'|trans }}</th>
    <th>{{ 'sylius.ui.code'|trans }}</th>
    <th>{{ 'sylius.form.promotion_coupon.usage_limit'|trans }}</th>
    <th>{{ 'sylius.form.promotion_coupon.per_customer_usage_limit'|trans }}</th>
    <th>{{ 'sylius.form.promotion_coupon.expires_at'|trans }}</th>
    <th class="text-right">{% trans %}promotion_coupon.used.label{% endtrans %}</th>
    {% if show_feature %}
    <th></th>
    {% endif %}
    {% if show_archive %}
    <th></th>
    {% endif %}
  </thead>
  <tbody>

  {% for promotion in promotions %}
    {% set coupon = null %}
    {% if promotion.isCouponBased %}
      {% set coupon = promotion.coupons|first %}
    {% endif %}
    <tr>
      <td><a href="{{ path(promotion_route, {
        restaurantId: restaurant.id,
        promotionId: promotion.id }) }}">#{{ promotion.id }}</a>
      </td>
      <td>
        <span>{{ promotion.name }}</span>
        <ul class="list-unstyled">
        {% for promotion_rule in promotion.rules %}
          <li>
            <small>{{ promotion_rule|promotion_rule_for_humans }}</small>
          </li>
        {% endfor %}
        </ul>
        <ul class="list-unstyled">
        {% for promotion_action in promotion.actions %}
          <li>
            <small>{{ promotion_action|promotion_action_for_humans }}</small>
          </li>
        {% endfor %}
        </ul>
      </td>
      <td>
        {% if promotion.isCouponBased %}
          <span class="text-monospace">{{ coupon.code }}</span>
        {% endif %}
      </td>
      <td>
        {% if promotion.isCouponBased %}
          {{ coupon.usageLimit }}
        {% else %}
          {{ promotion.usageLimit }}
        {% endif %}
      </td>
      <td>
        {% if promotion.isCouponBased %}
          {{ coupon.perCustomerUsageLimit }}
        {% endif %}
      </td>
      <td>
        {% if promotion.endsAt is not empty %}
          {{ promotion.endsAt|format_datetime('medium', 'short') }}
        {% endif %}
      </td>
      <td class="text-right"></td>
      {% if show_feature %}
      <td>
        <form method="post" action="{{ path(promotion_feature_route, {restaurantId: restaurant.id }) }}">
          <input type="hidden" name="type" value="promotion" />
          <input type="hidden" name="id" value={{ promotion.id }} />
          <button class="btn btn-sm {% if promotion.featured %}btn-success{% endif %}">
            {% if promotion.featured %}
              <i class="fa fa-check mr-1"></i><span>{{ 'promotions.featured'|trans }}</span>
            {% else %}
              <i class="fa fa-arrow-right mr-1"></i><span>{{ 'promotions.feature'|trans }}</span>
            {% endif %}
          </button>
        </form>
      </td>
      {% endif %}
      {% if show_archive %}
      <td class="text-right">
        <form method="post" action="{{ path(promotion_archive_route, {restaurantId: restaurant.id}) }}">
          <input type="hidden" name="type" value="promotion" />
          <input type="hidden" name="id" value={{ promotion.id }} />
          <button class="btn btn-sm btn-default" title="Archive" type="submit" onclick="return window.confirm('{{ 'basics.are_you_sure'|trans|escape('js') }}')">
            <i class="fa fa-archive"></i>
          </button>
        </form>
      </td>
    </tr>
    {% endif %}
  {% endfor %}
  </tbody>
</table>
