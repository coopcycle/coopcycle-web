{% extends 'restaurant/layout.html.twig' %}

{% block breadcrumb %}
  <li><a href="{{ path(restaurants_route) }}">{% trans %}adminDashboard.shops.title{% endtrans %}</a></li>
  <li><a href="{{ path(restaurant_route, { id: restaurant.id }) }}">{{ restaurant.name }}</a></li>
{% endblock %}

{% block content %}

<div class="text-right mb-4">
  <div class="btn-group">
    <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-plus mr-2"></i>{{ 'basics.add'|trans }} <span class="caret"></span>
    </button>
    <ul class="dropdown-menu dropdown-menu-right">
      <li>
        <a href="{{ path(promotion_new_route, { id: restaurant.id, type: 'offer_delivery' }) }}">
          {{ 'restaurant_promotion.offer_delivery'|trans }}
        </a>
      </li>
      <li>
        <a href="{{ path(promotion_new_route, { id: restaurant.id, type: 'items_total' }) }}">
          {{ 'restaurant_promotion.items_total'|trans }}
        </a>
      </li>
    </ul>
  </div>
</div>

<table class="table">
  <thead>
    {# <th>#</th> #}
    <th>{{ 'basics.name'|trans }}</th>
    <th>{{ 'sylius.ui.code'|trans }}</th>
    <th>{{ 'sylius.form.promotion_coupon.usage_limit'|trans }}</th>
    <th>{{ 'sylius.form.promotion_coupon.per_customer_usage_limit'|trans }}</th>
    <th>{{ 'sylius.form.promotion_coupon.expires_at'|trans }}</th>
    <th class="text-right">{% trans %}promotion_coupon.used.label{% endtrans %}</th>
  </thead>
  <tbody>
  {% for promotion in promotions %}
    {% if promotion.isCouponBased() %}
      {% for coupon in promotion.coupons %}
      <tr>
        <td>{{ promotion.name }}</td>
        <td>
          {{ coupon.code }}
        </td>
        <td>
          {{ coupon.usageLimit }}
        </td>
        <td>
          {{ coupon.perCustomerUsageLimit }}
        </td>
        <td>
          {% if coupon.expiresAt is not empty %}
            {{ coupon.expiresAt|format_datetime('medium', 'short') }}
          {% endif %}
        </td>
        <td class="text-right">
          {{ coupon.used }}
        </td>
      </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td>
          <span>{{ promotion.name }}</span>
          <ul class="list-unstyled">
          {% for promotion_rule in promotion.rules %}
            <li>
              <small>{{ promotion_rule|promotion_rule_for_humans }}</small>
            </li>
          {% endfor %}
          </ul>
          <ul class="list-unstyled">
          {% for promotion_action in promotion.actions %}
            <li>
              <small>{{ promotion_action|promotion_action_for_humans }}</small>
            </li>
          {% endfor %}
          </ul>
        </td>
        <td></td>
        <td>
          {{ promotion.usageLimit }}
        </td>
        <td></td>
        <td>
          {% if promotion.endsAt is not empty %}
            {{ promotion.endsAt|format_datetime('medium', 'short') }}
          {% endif %}
        </td>
        <td class="text-right"></td>
      </tr>
    {% endif %}
  {% endfor %}
  </tbody>
</table>

{% endblock %}
